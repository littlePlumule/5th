<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>week8-2</title>
    <link rel="stylesheet" href="week8-2.css">
</head>

<body>
    <nav class="navbar">
        <div class="logo">Twitch TOP Games</div>
        <div class="nav__wrap">
        </div>
    </nav>

    <div class="banner">
        <h1 class="banner__title">League of Legends</h1>
        <p class="banner__desc">Top 20 popular live streams sorted by current viewers</p>
        <div class="videos">

        </div>
        <!-- <div class="video__empty"></div>
        <div class="video__empty"></div> -->
    </div>
    <script>
        const clientId = 'ph7kfg58fkitm88sogja5xzqm4tlyp'
        const url = 'https://api.twitch.tv/kraken'
        const accept = 'application/vnd.twitchtv.v5+json'
        const req = new XMLHttpRequest()
        req.open('GET', `${url}/games/top?limit=5`, true)
        req.setRequestHeader('Accept', accept)
        req.setRequestHeader('Client-ID', clientId)
        req.onload = () => {
            if (req.status >= 200 && req.status < 400) {
                const games = JSON.parse(req.response).top
                for (let game of games) {
                    let element = document.createElement("a")
                    element.innerHTML = game.game.name
                    document.querySelector(".nav__wrap").appendChild(element)

                }
                //顯示第一個遊戲的實況
                document.querySelector(".banner__title").innerText = games[0].game.name
                    //抓取締一個遊戲的實況內容
                const req2 = new XMLHttpRequest()
                req2.open('GET', `${url}/streams?game=` + encodeURIComponent(games[0].game.name), true)
                req2.setRequestHeader('Accept', accept)
                req2.setRequestHeader('Client-ID', clientId)
                req2.onload = () => {
                    if (req2.status >= 200 && req2.status < 400) {
                        const data = JSON.parse(req2.response).streams
                        console.log(data)
                        for (let stream of data) {
                            let str = document.createElement("div")
                            str.classList.add("video")
                            str.innerHTML =
                                `
                            <div class="video">
                                <img src="${stream.preview.large}" />
                                <div class="video__wrap">
                                    <div class="video__avatar">
                                        <img src="${stream.channel.logo}" />
                                        <div class="video__intro">
                                            <div class="intro__title">
                                                ${stream.channel.status}
                                                <div class="intro__channel">
                                                    ${stream.channel.name}
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>
                            `

                            document.querySelector(".videos").appendChild(str)
                        }
                    }
                }
                req2.send()
            }
        }
        req.send()

        document.querySelector(".nav__wrap").addEventListener("click", (e) => {
            if (e.target.tagName.toLowerCase() === "a") {
                const gameName = e.target.innerText
                document.querySelector(".banner__title").innerText = gameName
                document.querySelector(".videos").innerHTML = ""
                document.querySelector(".banner__title").innerText = gameName
                    //抓取締一個遊戲的實況內容
                const req2 = new XMLHttpRequest()
                req2.open('GET', `${url}/streams?game=` + encodeURIComponent(gameName), true)
                req2.setRequestHeader('Accept', accept)
                req2.setRequestHeader('Client-ID', clientId)
                req2.onload = () => {
                    if (req2.status >= 200 && req2.status < 400) {
                        const data = JSON.parse(req2.response).streams
                        console.log(data)
                        for (let stream of data) {
                            let str = document.createElement("div")
                            str.classList.add("video")
                            str.innerHTML =
                                `
                            <div class="video">
                                <img src="${stream.preview.large}" />
                                <div class="video__wrap">
                                    <div class="video__avatar">
                                        <img src="${stream.channel.logo}" />
                                        <div class="video__intro">
                                            <div class="intro__title">
                                                ${stream.channel.status}
                                                <div class="intro__channel">
                                                    ${stream.channel.name}
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>
                            `

                            document.querySelector(".videos").appendChild(str)
                        }
                    }
                }
                req2.send()
            }
        })
    </script>
</body>

</html>